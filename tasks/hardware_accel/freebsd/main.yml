# See FreeBSD Handbook instructions:
#   https://wiki.freebsd.org/Graphics#Hardware_Support
# Also supplementary instructions here:
#   https://docs.freebsd.org/en/books/handbook/x11/#x-install
#   https://freebsddesktop.github.io/2019/03/11/xorg-quickstart.html

# Note: Workaround for FreeBSD 14.2 failure to wire up drm-kmod packages.
#       Per release errata, solution is to build manually.
# Ref:  https://www.freebsd.org/releases/14.2R/errata/#open-issues
# - name: "Install 'drm-kmod' package, which contains both Intel and AMD drivers"
- name: "Build and install 'graphics/drm-61-kmod' package from source, to resolve FreeBSD 14.2 bug"
  community.general.portinstall:
    name:
      - 'graphics/drm-61-kmod'
      - 'gpu-firmware-amd-kmod-polaris10'
    state: present
    use_packages: false
  become: true
  become_user: root

- name: "Configure Intel video card hardware acceleration"
  ansible.builtin.include_tasks: intel.yml
  when: video_card_make == "Intel"

- name: "Configure AMD video card hardware acceleration"
  ansible.builtin.include_tasks: amd.yml
  when: video_card_make == "AMD"

